# 数据模型、SQL 补救笔记

ghj1222

[TOC]

SQL杀我！

## 数学符号

- 并/交/差运算：$R\cup S$ ， $R\cap S$ ， $R-S$
  注意：并交差运算需要满足两个表“相容”，也就是项数相同，每项对应相同。

- 广义笛卡尔积：$R\times S$ （暴力怼一起）

-  选择：$\sigma_{con}(R)$ ，$con$ 的表示为逻辑运算符连接算数/比较表达式。
  逻辑运算符：$\land \lor \lnot$ 算数/比较表达式：$X\theta Y$ ，$X$ 和 $Y$ 是项， $\theta \in \{>,\le,<,\ge,=,\ne\}$

- 投影：$\Pi_{A_1,\dots,A_k}(R)$ ，取出 $A_1, \dots, A_k$ 这些列来组成的表

- $\theta$ - 连接：$R\Join _{A\theta B}S$ ，取出 $R\times S$ 中满足 $R$ 的 $A$ 和 $S$ 的 $B$ 满足 $\theta$ 条件的数据构成的关系。

- 自然连接：$R \Join S$ ，取出$R\times S$ 中相同属性值 $B$ 相等的数据构成的关系。

## SQL 语言

结构化查询语言。

注意关键字可以不区分大小写，以下为了方便查看，关键字是全部大写的。

这里只包含课内的部分，没有包含修改删除操作

### SQL CREATE

建立表格

```sql
CREATE TABLE 表名(列名 类型名[, 列名 类型名]);
```

字符串用单引号，类型为`CHAR(长度)`；其它类型有`INTEGER`  `FLOAT(精度)`

类型名后面可以加修饰符`NOT NULL`；

### SQL INSERT

新增一行

```sql
INSERT INTO 表名 [(列1[, 列2, ...])] VALUES (值1[, 值2, ...]);
```

### SQL SELECT

用法：

```sql
SELECT [DISTINCT] 列名称1[, 列名称2, ...]
FROM 表名称1[,表名称2, ...]
WHERE 逻辑表达式 [逻辑运算符 逻辑表达式 ...]
[GROUP BY 分组条件[HAVING 分组过滤条件]]
[ORDER BY 列名 排序规则 [, 列名 排序规则 ...];
```

- Line 1：列名称为`*` ，代表取出表中所有列；`DISTINCT`代表过滤重复元素；
  列名称中允许做结果计算：例如`Table1.Col1 - Table2.Col1`；
  提供了聚集函数：`AGFUNC(列)`，其中`COUNT`（支持任何类型元素）代表返回出现次数，`SUM`与`AVG`（只支持数值元素）返回和与平均值，`MAX`与`MIN`（支持数值元素和字符元素）返回最大值和最小值；聚集函数后面可以跟`AS` 起别名；`COUNT(*)`直接返回行数。
- Line 2：如果有多个表表示多表联合操作（可以自身做笛卡尔积），多表做笛卡尔积；如果用多表联合操作，在列明表示时候需要用`表名.列名`注明表名；在提出列名称时，以及第一行的列名称时可以用`[AS] 别名`给列名、表名声明引用；第一行可以直接用第二行的表的别名；`AS`可以省略。
- Line 3：逻辑运算符：`AND` 和 `OR` ，用括号声明优先级，如果不声明则`AND`优于`OR`。
  逻辑表达式可以由`列 运算符 值` 或者类似的形式组成；运算符： `=`、`<>`(`!=`)、`<`、`>`、`<=`、`>=`、`BETWEEN`、`LIKE`。
  `LIKE`运算符：其中`LIKE` 运算符后面加模式串，代表模糊查询（前面可以加`NOT`）；`LIKE`的匹配规则为：`%`匹配零个或多个字符；`_`匹配任意单个字符；`\`转义，例如`\%`和`\_`。
  `IN `子查询：逻辑表达式为`表达式（列） [NOT] IN 子查询` ；相关子查询允许外层查询向内层查询传递表格，但是不允许内层查询向外层查询传递表格。
- Line 4：分组条件可以写列名，为按照列名分组；分组过滤条件为对分组进行过滤（不满足条件一组全没）；在分组过滤时候可以使用聚集函数（从而用聚集函数得到的值代表整个组）
- Line 5：排序规则有`ASC`和`DESC`，省略则默认为`ASC`。多个列名，第一个为排序第一关键字，类推。

